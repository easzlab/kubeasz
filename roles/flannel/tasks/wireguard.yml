# 安装 wireguard 支持
#- name: 添加 wireguard ppa 源
#  apt_repository:
#    repo: ppa:wireguard/wireguard
#  when: 'ansible_distribution == "Ubuntu"'

- name: 安装 wireguard-tools (Redhat)
  yum:
    name: wireguard-tools
    state: present
  when: ansible_os_family == "RedHat"

- name: 安装 wireguard-tools (Debian)
  apt:
    name: wireguard-tools 
    state: present
  when: ansible_os_family == "Debian"

- name: 生成 wireguard private key
  shell: wg genkey
  register: wg_privkey

- name: 上传 wireguard 配置文件
  template: 
    src: wireguard.conf.j2 
    dest: /etc/wireguard/{{ WIREGUARD_IF }}.conf

- name: 启动 wireguard service
  systemd:
    name: wg-quick@{{ WIREGUARD_IF }} 
    enabled: true
    state: started